<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù€ 400/500 Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    <style>
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS (ØªÙ… Ø¯Ù…Ø¬Ù‡Ø§ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©) */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #1e1e1e; color: white; text-align: center; margin: 0; padding: 10px; }
        h1 { color: #4caf50; margin-bottom: 20px; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† */
        .players-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .player-card { background-color: #333; padding: 15px; border-radius: 10px; border: 2px solid #4caf50; }
        .player-name, .round-label { font-size: 1.2em; font-weight: bold; margin-bottom: 5px; }
        .total-score { font-size: 2.5em; color: #ffeb3b; font-weight: bold; }
        
        /* Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ - ØªÙ… Ø¯Ù…Ø¬ type="text" Ùˆ type="number" Ù‡Ù†Ø§ */
        input[type="number"], input[type="text"] { width: 80%; padding: 8px; margin-top: 10px; border-radius: 5px; border: none; text-align: center; font-size: 1.1em; background-color: #555; color: white; }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn { background-color: #4caf50; color: white; padding: 15px 30px; border: none; border-radius: 50px; font-size: 1.2em; cursor: pointer; width: 80%; margin-top: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .btn:active { transform: scale(0.98); }
        .btn-reset { background-color: #f44336; margin-top: 30px; font-size: 1em; padding: 10px 20px; }
        .btn-edit { background-color: #2196f3; padding: 10px 20px; font-size: 1em; margin-bottom: 10px; }
        
        /* Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® */
        #history-log { margin-top: 30px; padding: 10px; background-color: #2a2a2a; border-radius: 10px; }
        #history-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        #history-table th, #history-table td { border: 1px solid #444; padding: 8px; color: white; }
        #history-table th { background-color: #4caf50; color: #1e1e1e; }
        #history-table tr:nth-child(even) { background-color: #383838; }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙÙˆØ² */
        #winner-msg { display: none; background-color: rgba(0, 0, 0, 0.9); position: fixed; top: 0; left: 0; right: 0; bottom: 0; justify-content: center; align-items: center; flex-direction: column; z-index: 100; }
        #winner-text { font-size: 3em; color: #4caf50; margin-bottom: 20px; }
    </style>
</head>
<body>

    <h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù€ 500 Ø§Ù„Ù…Ø­Ø¯Ø«Ø© â™ ï¸</h1>
    <div class="round-label" id="round-counter">Ø§Ù„Ø¬ÙˆÙ„Ø©: 1</div>

    <div class="players-container">
        <div class="player-card">
            <input type="text" id="name1" value="Ø§Ù„Ù„Ø§Ø¹Ø¨ 1" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 1">
            <div class="total-score" id="score1">0</div>
            <input type="text" id="input1" placeholder="Ø³Ø¬Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ø´Ø±Ø©">
        </div>
        <div class="player-card">
            <input type="text" id="name2" value="Ø§Ù„Ù„Ø§Ø¹Ø¨ 2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 2">
            <div class="total-score" id="score2">0</div>
            <input type="text" id="input2" placeholder="Ø³Ø¬Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ø´Ø±Ø©">
        </div>
        <div class="player-card">
            <input type="text" id="name3" value="Ø§Ù„Ù„Ø§Ø¹Ø¨ 3" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 3">
            <div class="total-score" id="score3">0</div>
            <input type="text" id="input3" placeholder="Ø³Ø¬Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ø´Ø±Ø©">
        </div>
        <div class="player-card">
            <input type="text" id="name4" value="Ø§Ù„Ù„Ø§Ø¹Ø¨ 4" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ 4">
            <div class="total-score" id="score4">0</div>
            <input type="text" id="input4" placeholder="Ø³Ø¬Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ø´Ø±Ø©">
        </div>
    </div>

    <button class="btn" onclick="addScores()">Ø³Ø¬Ù‘Ù„ Ø§Ù„Ù†Ø´Ø±Ø©</button>
    <button class="btn btn-reset" onclick="resetGame()">ØªØµÙÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø© (Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©)</button>
    
    <div id="history-log">
        <div class="round-label">Ø³Ø¬Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</div>
        <button class="btn btn-edit" onclick="undoLastRound()">ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø¢Ø®Ø± Ù†Ø´Ø±Ø©</button>
        <table id="history-table">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø¬ÙˆÙ„Ø©</th>
                    <th id="hist-name1">Ø§Ù„Ù„Ø§Ø¹Ø¨ 1</th>
                    <th id="hist-name2">Ø§Ù„Ù„Ø§Ø¹Ø¨ 2</th>
                    <th id="hist-name3">Ø§Ù„Ù„Ø§Ø¹Ø¨ 3</th>
                    <th id="hist-name4">Ø§Ù„Ù„Ø§Ø¹Ø¨ 4</th>
                </tr>
            </thead>
            <tbody id="history-body">
                </tbody>
        </table>
    </div>

    <div id="winner-msg">
        <div id="winner-text"></div>
        <button class="btn" onclick="resetGame()">Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©</button>
    </div>

    <script>
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù„Ø­ÙØ¸ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬ÙˆÙ„Ø§Øª
        let totals = [0, 0, 0, 0];
        let history = [];
        let currentRound = 1;
        const WINNING_SCORE = 500; // Ø­Ø¯ Ø§Ù„Ø®Ø³Ø§Ø±Ø©/Ø§Ù„ÙÙˆØ²

        // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        const inputs = [
            document.getElementById('input1'), document.getElementById('input2'),
            document.getElementById('input3'), document.getElementById('input4')
        ];
        const scoresElements = [
            document.getElementById('score1'), document.getElementById('score2'),
            document.getElementById('score3'), document.getElementById('score4')
        ];
        const nameInputs = [
            document.getElementById('name1'), document.getElementById('name2'),
            document.getElementById('name3'), document.getElementById('name4')
        ];
        const histNameHeaders = [
            document.getElementById('hist-name1'), document.getElementById('hist-name2'),
            document.getElementById('hist-name3'), document.getElementById('hist-name4')
        ];
        const historyBody = document.getElementById('history-body');
        const roundCounter = document.getElementById('round-counter');

        // **********************************************
        // ******* Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¯Ø¹Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© *******
        // **********************************************
        function convertArToEn(inputString) {
            if (!inputString) return '0';
            // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø§Ù„Ø´Ø±Ù‚ÙŠØ©)
            const arabic = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
            // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (Ø§Ù„ØºØ±Ø¨ÙŠØ©)
            const english = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            
            let result = inputString.toString();
            
            for (let i = 0; i < arabic.length; i++) {
                // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø§Ù„Ø´Ø±Ù‚ÙŠØ©) Ø¨Ù…Ø§ ÙŠÙ‚Ø§Ø¨Ù„Ù‡Ø§ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (Ø§Ù„ØºØ±Ø¨ÙŠØ©)
                result = result.replace(new RegExp(arabic[i], 'g'), english[i]);
            }
            return result;
        }
        // **********************************************
        // **********************************************

        // ØªØ­Ø¯ÙŠØ« Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙŠ Ø±Ø£Ø³ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ±Ù‡Ø§
        nameInputs.forEach((input, index) => {
            input.addEventListener('input', () => {
                histNameHeaders[index].innerText = input.value;
            });
        });

        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·
        function addScores() {
            let roundScores = [];
            let winnerFound = false;

            // 1. Ø¬Ù…Ø¹ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆÙ„Ø©
            for (let i = 0; i < 4; i++) {
                // Ù†Ø³ØªØ®Ø¯Ù… convertArToEn Ù‚Ø¨Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø±Ù‚Ù… (parseInt)
                let rawValue = inputs[i].value.trim(); // Ø§Ø³ØªØ®Ø¯Ø§Ù… trim Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª
                let enValue = convertArToEn(rawValue);
                let val = parseInt(enValue) || 0; 
                
                roundScores.push(val);
            }
            
            // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙƒÙ„ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø£ØµÙØ§Ø± (Ù„ØªØ¬Ù†Ø¨ Ù†Ø´Ø±Ø© ÙØ§Ø±ØºØ©)
            if (roundScores.every(score => score === 0)) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ø´Ø±Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.');
                return;
            }

            // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
            for (let i = 0; i < 4; i++) {
                totals[i] += roundScores[i];
                scoresElements[i].innerText = totals[i];
                inputs[i].value = ''; // Ù…Ø³Ø­ Ø®Ø§Ù†Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            }

            // 3. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬ÙˆÙ„Ø© Ù„Ù„Ø³Ø¬Ù„
            history.push({
                round: currentRound,
                scores: [...roundScores], // Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆÙ„Ø©
                totals: [...totals]      // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
            });
            
            // 4. ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„
            updateHistoryLog();

            // 5. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙØ§Ø¦Ø²/Ø§Ù„Ø®Ø§Ø³Ø±
            for (let i = 0; i < 4; i++) {
                if (totals[i] >= WINNING_SCORE) {
                    showWinner(i + 1, nameInputs[i].value);
                    winnerFound = true;
                }
            }

            if (!winnerFound) {
                currentRound++;
                roundCounter.innerText = `Ø§Ù„Ø¬ÙˆÙ„Ø©: ${currentRound}`;
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„
        function updateHistoryLog() {
            historyBody.innerHTML = ''; // Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…
            
            history.forEach((roundData) => {
                let row = historyBody.insertRow();
                
                // Ø®Ù„ÙŠØ© Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆÙ„Ø©
                let cellRound = row.insertCell();
                cellRound.innerText = roundData.round;
                
                // Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ© (Ù†Ø¶Ø¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„)
                roundData.totals.forEach((totalScore, index) => {
                    let cellScore = row.insertCell();
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø¢Ø®Ø± Ù†ØªÙŠØ¬Ø© Ù…ÙØ³Ø¬Ù„Ø© Ø¨ÙŠÙ† Ù‚ÙˆØ³ÙŠÙ† (Ù„Ù„ØªÙˆØ¶ÙŠØ­)
                    let lastScore = roundData.scores[index];
                    cellScore.innerText = `${totalScore} (${lastScore})`;
                    
                    // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø°ÙŠ ØªØ®Ø·Ù‰ Ø­Ø¯ Ø§Ù„Ø®Ø³Ø§Ø±Ø©
                    if (totalScore >= WINNING_SCORE) {
                        row.style.backgroundColor = '#f44336aa'; // Ø®Ù„ÙÙŠØ© Ø­Ù…Ø±Ø§Ø¡
                        row.style.color = 'white';
                    }
                });
            });
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ø£Ø³ÙÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø±Ø¤ÙŠØ© Ø¢Ø®Ø± Ù†Ø´Ø±Ø©
            historyBody.scrollTop = historyBody.scrollHeight;
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø¢Ø®Ø± Ù†Ø´Ø±Ø© (ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·)
        function undoLastRound() {
            if (history.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§.');
                return;
            }
            
            const lastRound = history.pop(); // Ø­Ø°Ù Ø¢Ø®Ø± Ø¬ÙˆÙ„Ø©
            currentRound--;
            roundCounter.innerText = `Ø§Ù„Ø¬ÙˆÙ„Ø©: ${currentRound}`;
            
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ Ù…Ù† Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø®ÙŠØ±Ø© (Ø£Ùˆ ØµÙØ± Ø¥Ù† Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¬ÙˆÙ„Ø§Øª Ø³Ø§Ø¨Ù‚Ø©)
            if (history.length > 0) {
                const previousTotals = history[history.length - 1].totals;
                totals = [...previousTotals];
            } else {
                totals = [0, 0, 0, 0];
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            for (let i = 0; i < 4; i++) {
                scoresElements[i].innerText = totals[i];
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„
            updateHistoryLog();
            
            alert(`ØªÙ… Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆÙ„Ø© Ø±Ù‚Ù… ${lastRound.round} Ø¨Ù†Ø¬Ø§Ø­.`);
            // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙÙˆØ² Ø¥Ù† ÙƒØ§Ù†Øª Ø¸Ø§Ù‡Ø±Ø©
            document.getElementById('winner-msg').style.display = 'none';
        }

        function showWinner(playerNum, playerName) {
            document.getElementById('winner-msg').style.display = 'flex';
            document.getElementById('winner-text').innerText = ` Ù…Ø¨Ø±ÙˆÙƒ! Ø®Ø³Ø±Øª ÙŠØ§Ù„Ø´ÙŠØ®  
 ${playerName} ğŸ˜¹ ${WINNING_SCORE} Ù†Ù‚Ø·Ø©.`;
        }

        function resetGame() {
            // ØªØµÙÙŠØ± Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
            totals = [0, 0, 0, 0];
            history = [];
            currentRound = 1;

            // ØªØµÙÙŠØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            for (let i = 1; i <= 4; i++) {
                document.getElementById('score' + i).innerText = '0';
                document.getElementById('input' + i).value = '';
            }
            document.getElementById('winner-msg').style.display = 'none';
            document.getElementById('history-body').innerHTML = ''; // Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
            document.getElementById('round-counter').innerText = 'Ø§Ù„Ø¬ÙˆÙ„Ø©: 1';
        }
    </script>

</body>
</html>
